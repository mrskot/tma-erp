<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–∞—è–≤–∫–∏ - –ü–†–û–°–¢–û–ô –¢–ï–°–¢</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .app-card { border:1px solid #ddd; padding:15px; margin:10px; border-radius:8px; }
        .loading { padding:40px; text-align:center; color:#666; }
        .error { background:#f8d7da; color:#721c24; padding:15px; border-radius:8px; margin:20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìã –ó–∞—è–≤–∫–∏ –û–¢–ö (—Ç–µ—Å—Ç–æ–≤–∞—è –≤–µ—Ä—Å–∏—è)</h1>
        <button onclick="loadData()" class="btn btn-primary">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞—è–≤–∫–∏</button>
        <div id="applications-list" class="loading">–ù–∞–∂–º–∏—Ç–µ "–ó–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞—è–≤–∫–∏"</div>
    </div>

    <script>
        async function loadData() {
            const container = document.getElementById('applications-list');
            container.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> –ó–∞–≥—Ä—É–∑–∫–∞...</div>';
            
            try {
                console.log('üîÑ –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º API...');
                const response = await fetch('/api/v1/applications');
                const data = await response.json();
                
                console.log('üìä –û—Ç–≤–µ—Ç API:', data);
                
                if (data.success && data.applications.length > 0) {
                    let html = '<div class="applications-table">';
                    
                    data.applications.forEach(app => {
                        html += `
                            <div class="app-card">
                                <h3>–ó–∞—è–≤–∫–∞ #${app.application_number || app.id}</h3>
                                <p><strong>–£—á–∞—Å—Ç–æ–∫:</strong> ${app.lot_name || '‚Äî'}</p>
                                <p><strong>–ò–∑–¥–µ–ª–∏–µ:</strong> ${app.product_name || '‚Äî'}</p>
                                <p><strong>–ß–µ—Ä—Ç–µ–∂:</strong> ${app.drawing_number || '‚Äî'}</p>
                                <p><strong>–°–µ—Ä–∏–π–Ω–∏–∫:</strong> ${app.product_serial_number || '‚Äî'}</p>
                                <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${app.status}</p>
                                <p><small>–°–æ–∑–¥–∞–Ω–∞: ${new Date(app.created_at).toLocaleString()}</small></p>
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                    container.innerHTML = html;
                    console.log('‚úÖ –ó–∞—è–≤–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω—ã!');
                } else {
                    container.innerHTML = `<div class="error">–ù–µ—Ç –∑–∞—è–≤–æ–∫ –∏–ª–∏ –æ—à–∏–±–∫–∞: ${data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}</div>`;
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞:', error);
                container.innerHTML = `<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</div>`;
            }
        }
        
        // –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
        document.addEventListener('DOMContentLoaded', loadData);
    </script>
<script>
    console.log('üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...');
    
    // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ DOM
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializePage);
    } else {
        initializePage();
    }
    
            // –ö–Ω–æ–ø–∫–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
            const debugBtn = document.createElement('button');
            debugBtn.textContent = 'üõ†Ô∏è DEBUG';
            debugBtn.style.cssText = 'position:fixed; top:20px; right:20px; z-index:9999; padding:10px; background:#ff9800; color:white; border:none; border-radius:5px; cursor:pointer;';
            debugBtn.onclick = function() {
                console.log('=== DEBUG INFO ===');
                console.log('–ó–∞—è–≤–∫–∏:', window.applications);
                console.log('–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä:', document.getElementById('applications-list'));
                console.log('–†–µ–Ω–¥–µ—Ä —Ñ—É–Ω–∫—Ü–∏—è:', typeof renderApplicationsTable);
                if (typeof loadApplications === 'function') loadApplications();
            };
            document.body.appendChild(debugBtn);
        </script>

</body>
</html>