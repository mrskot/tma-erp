<!-- telegram-simulator.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß –°–∏–º—É–ª—è—Ç–æ—Ä Telegram WebApp | TMA-ERP</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 800px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 16px;
        }
        
        .simulator-card {
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            background: #f8f9fa;
        }
        
        .role-selector {
            margin-bottom: 25px;
        }
        
        .role-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        
        .role-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .role-btn.master {
            background: #4CAF50;
            color: white;
        }
        
        .role-btn.otk {
            background: #2196F3;
            color: white;
        }
        
        .role-btn.admin {
            background: #9C27B0;
            color: white;
        }
        
        .role-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .role-btn.active {
            box-shadow: 0 0 0 3px rgba(0,0,0,0.1);
        }
        
        .users-list {
            margin-top: 20px;
        }
        
        .user-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-card:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }
        
        .user-card.selected {
            border-color: #4CAF50;
            background: #e8f5e9;
        }
        
        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 20px;
        }
        
        .user-info h3 {
            margin: 0;
            color: #333;
        }
        
        .user-info p {
            margin: 5px 0 0;
            color: #666;
            font-size: 14px;
        }
        
        .launch-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 16px 32px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            margin-top: 30px;
            transition: all 0.3s;
        }
        
        .launch-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }
        
        .launch-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin-top: 20px;
            border-radius: 8px;
            font-size: 14px;
            color: #1565c0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>
            <span style="font-size: 32px;">üîß</span>
            –°–∏–º—É–ª—è—Ç–æ—Ä Telegram WebApp
        </h1>
        <p class="subtitle">–ò–º–∏—Ç–∞—Ü–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Telegram –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ TMA-ERP</p>
        
        <div class="simulator-card">
            <h2>1. –í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å</h2>
            <div class="role-buttons">
                <button class="role-btn master active" data-role="master">
                    <span>üë∑</span> –ú–∞—Å—Ç–µ—Ä —É—á–∞—Å—Ç–∫–∞
                </button>
                <button class="role-btn otk" data-role="otk_inspector">
                    <span>üë®‚Äçüî¨</span> –ö–æ–Ω—Ç—Ä–æ–ª—ë—Ä –û–¢–ö
                </button>
                <button class="role-btn admin" data-role="admin">
                    <span>üë®‚Äçüíº</span> –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
                </button>
            </div>
            
            <h2 style="margin-top: 30px;">2. –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
            <div class="users-list" id="users-list">
                <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã JavaScript -->
            </div>
            
            <div class="info-box">
                <strong>‚ÑπÔ∏è –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:</strong><br>
                –í –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ —Å–∏–º—É–ª–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ Telegram –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. 
                –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –±—É–¥–µ—Ç —Ä–µ–∞–ª—å–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram WebApp.
            </div>
        </div>
        
        <button class="launch-btn" id="launch-btn" disabled onclick="launchAsUser()">
            <span>üöÄ</span> –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        </button>
    </div>

    <script>
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –∞–¥–º–∏–Ω–∫–∏
        (function() {
            const adminUser = {
                id: 9999,
                first_name: 'Admin',
                username: 'admin_bot', 
                role: 'admin',
                auth_date: Math.floor(Date.now() / 1000),
                hash: 'admin_hash'
            };
            
            localStorage.setItem('telegram_user', JSON.stringify(adminUser));
            console.log('‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –∞–¥–º–∏–Ω–∫–∏');
        })();
        
        
        // –¢–µ—Å—Ç–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏
        const testUsers = {
            master: [
                {
                    id: 1001,
                    first_name: "–ò–≤–∞–Ω",
                    last_name: "–ü–µ—Ç—Ä–æ–≤",
                    username: "master_ivan",
                    lot_id: 7,
                    lot_name: "–£—á–∞—Å—Ç–æ–∫ —Å–±–æ—Ä–∫–∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ç–æ—Ä–æ–≤",
                    role: 'master'
                },
                {
                    id: 1002,
                    first_name: "–ê–ª–µ–∫—Å–µ–π",
                    last_name: "–°–∏–¥–æ—Ä–æ–≤", 
                    username: "master_alex",
                    lot_id: 2,
                    lot_name: "–£—á–∞—Å—Ç–æ–∫ –ø–æ–∫—Ä–∞—Å–∫–∏",
                    role: 'master'
                },
                {
                    id: 1003,
                    first_name: "–ú–∞—Ä–∏—è",
                    last_name: "–ò–≤–∞–Ω–æ–≤–∞",
                    username: "master_maria",
                    lot_id: 3,
                    lot_name: "–£—á–∞—Å—Ç–æ–∫ —É–ø–∞–∫–æ–≤–∫–∏",
                    role: 'master'
                }
            ],
            otk_inspector: [
                {
                    id: 2001,
                    first_name: "–°–µ—Ä–≥–µ–π",
                    last_name: "–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π",
                    username: "otk_sergey",
                    role: 'otk_inspector'
                },
                {
                    id: 2002,
                    first_name: "–û–ª—å–≥–∞",
                    last_name: "–ü—Ä–æ–≤–µ—Ä—è—é—â–∞—è",
                    username: "otk_olga",
                    role: 'otk_inspector'
                }
            ],
            admin: [
                {
                    id: 3001,
                    first_name: "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä",
                    username: "admin_bot",
                    role: 'admin'
                }
            ]
        };

        let selectedRole = 'master';
        let selectedUser = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            loadUsersForRole(selectedRole);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ —Ä–æ–ª–µ–π
            document.querySelectorAll('.role-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // –°–Ω–∏–º–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö
                    document.querySelectorAll('.role-btn').forEach(b => b.classList.remove('active'));
                    // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–º—É
                    this.classList.add('active');
                    
                    selectedRole = this.dataset.role;
                    selectedUser = null;
                    document.getElementById('launch-btn').disabled = true;
                    loadUsersForRole(selectedRole);
                });
            });
        });

        function loadUsersForRole(role) {
            const container = document.getElementById('users-list');
            container.innerHTML = '';
            
            testUsers[role].forEach(user => {
                const userCard = document.createElement('div');
                userCard.className = 'user-card';
                userCard.dataset.user = JSON.stringify(user);
                
                // –ê–≤–∞—Ç–∞—Ä —Å –∏–Ω–∏—Ü–∏–∞–ª–∞–º–∏
                const initials = (user.first_name[0] + (user.last_name ? user.last_name[0] : user.first_name[1] || '')).toUpperCase();
                
                userCard.innerHTML = `
                    <div class="user-avatar">${initials}</div>
                    <div class="user-info">
                        <h3>${user.first_name} ${user.last_name || ''}</h3>
                        <p>@${user.username} ‚Ä¢ ${getRoleDisplay(role)}</p>
                        ${user.lot_name ? `<p><small>${user.lot_name}</small></p>` : ''}
                    </div>
                `;
                
                userCard.addEventListener('click', function() {
                    // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ
                    document.querySelectorAll('.user-card').forEach(card => {
                        card.classList.remove('selected');
                    });
                    
                    // –í—ã–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–µ–≥–æ
                    this.classList.add('selected');
                    
                    selectedUser = JSON.parse(this.dataset.user);
                    document.getElementById('launch-btn').disabled = false;
                    
                    console.log('–í—ã–±—Ä–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', selectedUser);
                });
                
                container.appendChild(userCard);
            });
        }

        function getRoleDisplay(role) {
            const roles = {
                master: 'üë∑ –ú–∞—Å—Ç–µ—Ä —É—á–∞—Å—Ç–∫–∞',
                otk_inspector: 'üë®‚Äçüî¨ –ö–æ–Ω—Ç—Ä–æ–ª—ë—Ä –û–¢–ö',
                admin: 'üë®‚Äçüíº –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä'
            };
            return roles[role] || role;
        }

        function launchAsUser() {
            if (!selectedUser) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!');
                return;
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ localStorage
            const userData = {
                ...selectedUser,
                auth_date: Math.floor(Date.now() / 1000),
                hash: 'simulated_hash_' + Date.now()
            };
            
            localStorage.setItem('telegram_user', JSON.stringify(userData));
            
            // –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –Ω—É–∂–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
            let redirectUrl;
            
            switch (selectedUser.role) {
                case 'master':
                    redirectUrl = '/admin/master.html';
                    break;
                case 'otk_inspector':
                    redirectUrl = '/admin/applications.html';
                    break;
                case 'admin':
                    redirectUrl = '/admin/applications.html';
                    break;
                default:
                    redirectUrl = '/admin/applications.html';
            }
            
            console.log('üöÄ –ó–∞–ø—É—Å–∫ –∫–∞–∫:', selectedUser.first_name, '->', redirectUrl);
            
            // –†–µ–¥–∏—Ä–µ–∫—Ç —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–ª—è UX
            setTimeout(() => {
                window.location.href = redirectUrl;
            }, 300);
        }
        
        // –î–ª—è –æ—Ç–ª–∞–¥–∫–∏
        window.debugUsers = testUsers;
    </script>
</body>
</html>